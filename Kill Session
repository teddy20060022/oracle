--cek active session
SET PAGESIZE 1000
SET LINES 300
SELECT machine,
       NVL(active_count, 0) AS active,
       NVL(inactive_count, 0) AS inactive,
       NVL(killed_count, 0) AS killed,
	   SERVICE_NAME
FROM   (SELECT machine, status, SERVICE_NAME,count(*) AS quantity
        FROM   v$session
        GROUP BY machine, status,SERVICE_NAME)
PIVOT  (SUM(quantity) AS count FOR (status) IN ('ACTIVE' AS active, 'INACTIVE' AS inactive, 'KILLED' AS killed))
ORDER BY machine;

--cek utilisasi process-session
set lines 300
col INITIAL_ALLOCATION for a17
col LIMIT_VALUE for a12
col resource_name for a30
select inst_id,resource_name,current_utilization,max_utilization,
INITIAL_ALLOCATION,LIMIT_VALUE,round(((current_utilization*100)/(INITIAL_ALLOCATION)),2) as "Process limit %"
from gv$resource_limit
where resource_name in ('sessions', 'processes');

--kill session
kill -9 ps -ef | grep LOCAL=NO | grep oracleOPBIBSD1  | grep -v grep | awk '{print $2}'

--select for kill session
SET LINES 300 PAGES 1000
select 'ALTER SYSTEM KILL SESSION '''||sid||','||serial#||',@'||inst_id||''' IMMEDIATE;' FROM gv$session where username in ('SKYPROD'') AND status = 'INACTIVE' ;
